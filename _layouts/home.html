<!doctype html>
<html lang="en-US">
  <head>
    {% include head.html %}
    <link
      rel="preload"
      href="/assets/css/home.css"
      as="style"
      onload="this.rel='stylesheet'"
    />
    <link
      rel="preload"
      href="/assets/css/tiles.css"
      as="style"
      onload="this.rel='stylesheet'"
    />

    {% assign first_post = site.posts | first %} {% assign featured_image =
    first_post.image | replace: '.webp', '-588x396.webp' %}
    <link rel="preload" href="{{ featured_image }}" as="image" />
    <noscript>
      <link rel="stylesheet" href="/assets/css/home.css" />
      <link rel="stylesheet" href="/assets/css/tiles.css" />
    </noscript>
  </head>

  <body>
    {% include nav.html %}
    <main class="fixed-width">
      <section>
        <div class="featured-grid">
          {% assign posts = site.posts | slice: 0, 4 %} {% for post in posts %}
          {% if forloop.first %}
          <div class="article featured">
            <div class="image">
              <a href="{{ post.url }}">
                {% assign featured_image = post.image | replace: '.webp',
                '-588x396.webp' %}
                <img
                  src="{{ featured_image }}"
                  alt="{{ post.title }}"
                  width="588"
                  height="396"
                />
              </a>
            </div>
            <div class="info">
              <span class="cat"><a href=" {{ post.category | slugify | relative_url }}">{{ post.category }}</a></span>
              <a href="{{ post.url }}">
                <h3>{{ post.title }}</h3>
              </a>
              {{ post.excerpt | strip_html | truncatewords: 20 }}
            </div>
          </div>
          {% else %}
          <div class="article sidebar">
            <div class="image">
              <a href="{{ post.url }}">
                {% assign sidebar_image = post.image | replace: '.webp',
                '-270x270.webp' %}
                <img
                  src="{{ sidebar_image }}"
                  alt="{{ post.title }}"
                  loading="lazy"
                />
              </a>
            </div>
            <div class="info">
              <span class="cat"><a href=" {{ post.category | slugify | relative_url }}">{{ post.category }}</a></span>
              <a href="{{ post.url }}">
                <h3>{{ post.title }}</h3>
              </a>
            </div>
          </div>
          {% endif %} {% endfor %}
        </div>
      </section>

      <section>
        <h2>Recent articles</h2>

        <div class="tiles">
          {% assign posts = site.posts | slice: 4, 10 %} {% for post in posts %}
          <div class="article tile">
            <div class="image">
              <a href="{{ post.url  | relative_url }}">
                <picture>
                  <!-- Use -768x320.webp for viewports 768px or smaller -->
                  <source 
                    media="(max-width: 768px)" 
                    srcset="{{ post.image | replace: '.webp', '-768x320.webp' }}"
                  >
                  <!-- Default image for larger viewports -->
                  <img
                    src="{{ post.image | replace: '.webp', '-384x256.webp' }}"
                    alt="{{ post.title }}"
                    loading="lazy"
                  />
                </picture>
              </a>
            </div>
            <div class="info">
              <span class="cat"><a href=" {{ post.category | slugify | relative_url }}">{{ post.category }}</a></span>
              <a href="{{ post.url | relative_url  }}">
                <h3>{{ post.title }}</h3>
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </section>

      <section>
        <h2>Top destinations</h2>

        {% assign categories_array = "" | split:"|" %} {% for post in site.posts
        %} {% if post.category %} {% assign categories_array = categories_array
        | push: post.category | uniq %} {% endif %} {% endfor %}

        <div class="destinations">
          {% for destination in site.destinations %}
          <div class="destination">
            {% if destination.image%}
            {% assign dest_image = destination.image | replace: '.webp', '-278x379.webp' %}
            <div class="image">
              <a
                href="{{ destination.url | relative_url }}"
              >
                <img
                  src="{{
                    dest_image }}"
                  alt="{{ destination.title }}"
                  loading="lazy"
                  width="278"
                  height="379"
              /></a>
            </div>
            {% endif %}
            <a
              href="{{ destination.url | relative_url }}"
            >
              <h3>{{ destination.title }}</h3>
            </a>
          </div>
          {% endfor %}
        </div>
        <script>
          document.addEventListener("DOMContentLoaded", () => {
            const destinations = document.querySelector(".destinations");
            let isDragging = false;
            let startX, startY;
            let scrollLeft;
            let lastX, lastY;
            let isHorizontal = false;

            // Prevent default image dragging
            destinations.querySelectorAll("img").forEach((img) => {
              img.setAttribute("draggable", "false");
              img.style.userSelect = "none";
            });

            const startDragging = (x, y) => {
              isDragging = true;
              startX = x - destinations.offsetLeft;
              startY = y;
              lastX = x;
              lastY = y;
              scrollLeft = destinations.scrollLeft;
              destinations.style.cursor = "grabbing";
              isHorizontal = false; // Reset direction detection
            };

            const stopDragging = () => {
              isDragging = false;
              destinations.style.cursor = "grab";
            };

            // Mouse events
            destinations.addEventListener("mousedown", (e) => {
              startDragging(e.pageX, e.pageY);
            });

            destinations.addEventListener("mouseleave", stopDragging);
            destinations.addEventListener("mouseup", stopDragging);

            destinations.addEventListener("mousemove", (e) => {
              if (!isDragging) return;

              const x = e.pageX - destinations.offsetLeft;
              const y = e.pageY;

              // Determine direction only once at the start of the drag
              if (!isHorizontal) {
                const deltaX = Math.abs(x - lastX);
                const deltaY = Math.abs(y - lastY);
                // Use a threshold to decide if the movement is horizontal
                if (deltaX > 5 || deltaY > 5) {
                  isHorizontal = deltaX > deltaY;
                }
              }

              // Only prevent default and scroll horizontally if the movement is horizontal
              if (isHorizontal) {
                e.preventDefault();
                const walk = (x - startX) * 1.5;
                destinations.scrollLeft = scrollLeft - walk;
              }

              lastX = x;
              lastY = y;
            });

            // Touch events
            destinations.addEventListener(
              "touchstart",
              (e) => {
                startDragging(e.touches[0].pageX, e.touches[0].pageY);
              },
              { passive: false }
            );

            destinations.addEventListener("touchend", stopDragging);
            destinations.addEventListener("touchcancel", stopDragging);

            destinations.addEventListener(
              "touchmove",
              (e) => {
                if (!isDragging) return;

                const x = e.touches[0].pageX - destinations.offsetLeft;
                const y = e.touches[0].pageY;

                // Determine direction only once at the start of the drag
                if (!isHorizontal) {
                  const deltaX = Math.abs(x - lastX);
                  const deltaY = Math.abs(y - lastY);
                  if (deltaX > 5 || deltaY > 5) {
                    isHorizontal = deltaX > deltaY;
                  }
                }

                // Only prevent default and scroll horizontally if the movement is horizontal
                if (isHorizontal) {
                  e.preventDefault();
                  const walk = (x - startX) * 1.5;
                  destinations.scrollLeft = scrollLeft - walk;
                }

                lastX = x;
                lastY = y;
              },
              { passive: false }
            );
          });
        </script>
      </section>
    </main>
    {% include footer.html %}
  </body>
</html>
